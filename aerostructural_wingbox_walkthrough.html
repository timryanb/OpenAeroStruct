
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aerostructural with Wingbox Walkthrough &#8212; OpenAeroStruct 2.3.2 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="User-Provided Mesh Example" href="custom_mesh_example.html" />
    <link rel="prev" title="Aerostructural Walkthrough" href="aerostructural_walkthrough.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="custom_mesh_example.html" title="User-Provided Mesh Example"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="aerostructural_walkthrough.html" title="Aerostructural Walkthrough"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OpenAeroStruct 2.3.2 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Aerostructural with Wingbox Walkthrough</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="aerostructural-with-wingbox-walkthrough">
<span id="id1"></span><h1>Aerostructural with Wingbox Walkthrough<a class="headerlink" href="#aerostructural-with-wingbox-walkthrough" title="Permalink to this headline">¶</a></h1>
<p>In addition to the tubular-spar structural model available in OpenAeroStruct, you can use a wingbox-based model.
This model is described in Chauhan and Martins’ paper <a class="reference external" href="https://www.researchgate.net/publication/327654423_Low-Fidelity_Aerostructural_Optimization_of_Aircraft_Wings_with_a_Simplified_Wingbox_Model_Using_OpenAeroStruct">here</a>.
We strongly recommend reading this relatively short conference paper to learn about the model and see some example results.
The presentation slides for this conference paper can be found <a class="reference external" href="https://www.researchgate.net/publication/327802989_Presentation_slides_for_Low-fidelity_Aerostructural_Optimization_of_Aircraft_Wings_with_a_Simplified_Wingbox_Model_Using_OpenAeroStruct">online</a>.
Analytic derivatives are not provided for some components of this model, so any optimization problem will use the complex-step approximation to obtain the relevant partial derivatives for these components.</p>
<img alt="_images/wingbox_fine.png" src="_images/wingbox_fine.png" />
<p>This page breaks down and describes an example optimization run-script that uses the wingbox model.
This example uses the same optimization problem used for the paper linked above, but with fewer design variables and a coarser mesh.
The wing being optimized is based on the undeflected Common Research Model (uCRM), which is a long-range transport aircraft.
A script to replicate the optimization problems described in the paper can be found in the examples directory (openaerostruct/examples/run_aerostruct_uCRM_multipoint.py).
Please contact Shamsheer Chauhan (<a class="reference external" href="mailto:sschau&#37;&#52;&#48;umich&#46;edu">sschau<span>&#64;</span>umich<span>&#46;</span>edu</a>) with any questions you have after reading the above paper and going through this example.</p>
<p>The goal of the wingbox model is to allow more realistic preliminary structural sizing for commuter to long-range transport-type aircraft which typically have wingbox structures.
Since more realistic sizing is one of the goals of the wingbox model, this example also shows how to use it with a multipoint optimization.
Wing structures are usually sized using loads that do not occur during normal cruise conditions, so we must consider at least one more flight point that provides more extreme loads.</p>
<p>This tutorial assumes that the reader has gone through the other examples and tutorials in the OpenAeroStruct documentation and is now familiar with how to set up problems and the terminology of OpenAeroStruct.</p>
<p>Let’s begin and look at the run-script now. First we import some modules.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">openaerostruct.geometry.utils</span> <span class="kn">import</span> <span class="n">generate_mesh</span>
<span class="kn">from</span> <span class="nn">openaerostruct.integration.aerostruct_groups</span> <span class="kn">import</span> <span class="n">AerostructGeometry</span><span class="p">,</span> <span class="n">AerostructPoint</span>
<span class="kn">from</span> <span class="nn">openaerostruct.structures.wingbox_fuel_vol_delta</span> <span class="kn">import</span> <span class="n">WingboxFuelVolDelta</span>
<span class="kn">import</span> <span class="nn">openmdao.api</span> <span class="k">as</span> <span class="nn">om</span>

</pre></div>
</div>
<p>Next, we provide some airfoil coordinates.
These coordinates are used to define the shape of the wingbox cross-section.
In this example, we use the NASA SC2-0612 coordinates from airfoiltools.com.
However, here we only provide the coordinates for the 10%- to 60%-chord portion of the airfoil because for this example we assume that it is this portion of the chord along the wing that will be structural and form the wingbox.
Make sure that the first and last x-coordinates (chordwise) of the upper and lower curves are the same.
Also make sure that the chord length of the original airfoil has been normalized to 1 (this is normally the case for the airfoil coordinates available on airfoiltools.com).</p>
<p>These coordinates will be scaled based on the effective chord and thickness-to-chord ratio for each wingbox segment along the wing.
However, we currently have not implemented the functionality to specify different airfoil coordinates for different segments of the wing, so the same coordinates are used for the entire wing.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Provide coordinates for a portion of an airfoil for the wingbox cross-section as an nparray with dtype=complex (to work with the complex-step approximation for derivatives).</span>
<span class="c1"># These should be for an airfoil with the chord scaled to 1.</span>
<span class="c1"># We use the 10% to 60% portion of the NASA SC2-0612 airfoil for this case</span>
<span class="c1"># We use the coordinates available from airfoiltools.com. Using such a large number of coordinates is not necessary.</span>
<span class="c1"># The first and last x-coordinates of the upper and lower surfaces must be the same</span>

<span class="c1"># fmt: off</span>
<span class="n">upper_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">,</span> <span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.27</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.36</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.46</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.52</span><span class="p">,</span> <span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.59</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex128&quot;</span><span class="p">)</span>
<span class="n">lower_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">,</span> <span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.27</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.36</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.46</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.52</span><span class="p">,</span> <span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.59</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex128&quot;</span><span class="p">)</span>
<span class="n">upper_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.0447</span><span class="p">,</span>  <span class="mf">0.046</span><span class="p">,</span>  <span class="mf">0.0472</span><span class="p">,</span>  <span class="mf">0.0484</span><span class="p">,</span>  <span class="mf">0.0495</span><span class="p">,</span>  <span class="mf">0.0505</span><span class="p">,</span>  <span class="mf">0.0514</span><span class="p">,</span>  <span class="mf">0.0523</span><span class="p">,</span>  <span class="mf">0.0531</span><span class="p">,</span>  <span class="mf">0.0538</span><span class="p">,</span> <span class="mf">0.0545</span><span class="p">,</span>  <span class="mf">0.0551</span><span class="p">,</span>  <span class="mf">0.0557</span><span class="p">,</span> <span class="mf">0.0563</span><span class="p">,</span>  <span class="mf">0.0568</span><span class="p">,</span> <span class="mf">0.0573</span><span class="p">,</span>  <span class="mf">0.0577</span><span class="p">,</span>  <span class="mf">0.0581</span><span class="p">,</span>  <span class="mf">0.0585</span><span class="p">,</span>  <span class="mf">0.0588</span><span class="p">,</span>  <span class="mf">0.0591</span><span class="p">,</span>  <span class="mf">0.0593</span><span class="p">,</span>  <span class="mf">0.0595</span><span class="p">,</span>  <span class="mf">0.0597</span><span class="p">,</span>  <span class="mf">0.0599</span><span class="p">,</span>  <span class="mf">0.06</span><span class="p">,</span>    <span class="mf">0.0601</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0601</span><span class="p">,</span>  <span class="mf">0.06</span><span class="p">,</span>    <span class="mf">0.0599</span><span class="p">,</span>  <span class="mf">0.0598</span><span class="p">,</span>  <span class="mf">0.0596</span><span class="p">,</span>  <span class="mf">0.0594</span><span class="p">,</span>  <span class="mf">0.0592</span><span class="p">,</span>  <span class="mf">0.0589</span><span class="p">,</span>  <span class="mf">0.0586</span><span class="p">,</span>  <span class="mf">0.0583</span><span class="p">,</span>  <span class="mf">0.058</span><span class="p">,</span>   <span class="mf">0.0576</span><span class="p">,</span>  <span class="mf">0.0572</span><span class="p">,</span>  <span class="mf">0.0568</span><span class="p">,</span>  <span class="mf">0.0563</span><span class="p">,</span>  <span class="mf">0.0558</span><span class="p">,</span>  <span class="mf">0.0553</span><span class="p">,</span>  <span class="mf">0.0547</span><span class="p">,</span>  <span class="mf">0.0541</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex128&quot;</span><span class="p">)</span>  <span class="c1"># noqa: E201, E241</span>
<span class="n">lower_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.0447</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.046</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0473</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0485</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0496</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0506</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0515</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0524</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0532</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.054</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0547</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0554</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.056</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0565</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.057</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0575</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0579</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0583</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0586</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0589</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0592</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0594</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0595</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0596</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0597</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0597</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0596</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0594</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0592</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0589</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0586</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0582</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0578</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0573</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0567</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0561</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0554</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0546</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0538</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0529</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0519</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0509</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0497</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0485</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0472</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0458</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0444</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex128&quot;</span><span class="p">)</span>
<span class="c1"># fmt: on</span>

</pre></div>
</div>
<p>Next, we create the dictionary with information for the mesh and create the mesh.
For this example we use the uCRM-based geometry (undeflected Common Research Model) already defined and available in OpenAeroStruct.
Alternatively, the user can provide their own mesh (see <a class="reference internal" href="custom_mesh_example.html#custom-mesh"><span class="std std-ref">User-Provided Mesh Example</span></a> for another example with a custom mesh).
Here we specify 15 as the number of spanwise nodes and 3 as the number of chordwise nodes for the VLM mesh.
We also set <cite>chord_cos_spacing</cite> and <cite>span_cos_spacing</cite> to <cite>0</cite> for uniform panel spacing.
The FEM model will use the spanwise spacing of the VLM mesh for the FEM mesh.
We use a very coarse mesh for this example to keep the computational time low.</p>
<p>The <cite>generate_mesh</cite> function takes the inputs from the mesh dictionary and returns the mesh as well as values for the B-spline control points for the twist distribution (we specify the number of control points for this using <cite>num_twist_cp</cite> in the dictionary).
Note that in this example we don’t end up using this twist distribution, but instead use a better starting twist distribution which will be seen later.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Create a dictionary to store options about the surface</span>
<span class="n">mesh_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;num_y&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="s2">&quot;num_x&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;wing_type&quot;</span><span class="p">:</span> <span class="s2">&quot;uCRM_based&quot;</span><span class="p">,</span>
    <span class="s2">&quot;symmetry&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;chord_cos_spacing&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;span_cos_spacing&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;num_twist_cp&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">mesh</span><span class="p">,</span> <span class="n">twist_cp</span> <span class="o">=</span> <span class="n">generate_mesh</span><span class="p">(</span><span class="n">mesh_dict</span><span class="p">)</span>

</pre></div>
</div>
<p>Next, we create a surface dictionary and provide necessary information for our lifting surface.
After providing the relevant information for the <cite>name</cite>, <cite>symmetry</cite>, and <cite>S_ref_type</cite> settings, we provide the mesh and specify the string <cite>‘wingbox’</cite> for the <cite>fem_model_type</cite> (if we wanted the tubular structure, we would specify <cite>‘tube’</cite> instead).
We also provide the airfoil coordinates for the wingbox cross-section here as the four arrays defined earlier.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">surf_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Wing definition</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;wing&quot;</span><span class="p">,</span>  <span class="c1"># give the surface some name</span>
    <span class="s2">&quot;symmetry&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># if True, model only one half of the lifting surface</span>
    <span class="s2">&quot;S_ref_type&quot;</span><span class="p">:</span> <span class="s2">&quot;projected&quot;</span><span class="p">,</span>  <span class="c1"># how we compute the wing area,</span>
    <span class="c1"># can be &#39;wetted&#39; or &#39;projected&#39;</span>
    <span class="s2">&quot;mesh&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="p">,</span>
    <span class="s2">&quot;fem_model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;wingbox&quot;</span><span class="p">,</span>  <span class="c1"># &#39;wingbox&#39; or &#39;tube&#39;</span>
    <span class="s2">&quot;data_x_upper&quot;</span><span class="p">:</span> <span class="n">upper_x</span><span class="p">,</span>
    <span class="s2">&quot;data_x_lower&quot;</span><span class="p">:</span> <span class="n">lower_x</span><span class="p">,</span>
    <span class="s2">&quot;data_y_upper&quot;</span><span class="p">:</span> <span class="n">upper_y</span><span class="p">,</span>
    <span class="s2">&quot;data_y_lower&quot;</span><span class="p">:</span> <span class="n">lower_y</span><span class="p">,</span>
</pre></div>
</div>
<p>Next, we provide some initial values for the wingbox spar and skin thickness distributions (B-spline control points), along with the wing twist distribution (note that these distributions do not need to have the same number of control points).
For the wingbox model, to maintain simplicity, we use the same thickness variables for both the top and bottom wing skins.
Similarly, we use the same thickness variables for the front and rear spars.
Currently, we do not model buckling or have any buckling constraints.
However, a comparison of optimized skin thicknesses with high-fidelity results shown in these <a class="reference external" href="https://www.researchgate.net/publication/327802989_Presentation_slides_for_Low-fidelity_Aerostructural_Optimization_of_Aircraft_Wings_with_a_Simplified_Wingbox_Model_Using_OpenAeroStruct">slides</a>, indicates that, assuming the wing has a reasonable rib spacing, this is not a very major concern.</p>
<p>We also provide a distribution for the thickness-to-chord ratio (B-spline control points for <cite>t_over_c_cp</cite>).
The thickness-to-chord ratio design variable is important for the trade-off between aerodynamic (wave and viscous drag) benefits from a thin wing and structural benefits from a thick wing.
The <cite>original_wingbox_airfoil_t_over_c</cite> is the thickness-to-chord ratio of the airfoil provided for the wingbox cross-section.
For this example, the thickness-to-chord ratio of the SC2-0612 is 12%.
This is used to scale the airfoil in the thickness direction as the thickness-to-chord ratio variable changes.
Note that the thickness-to-chord ratio variable is the streamwise value.
Using the sweep angle for the wingbox elements OpenAeroStruct computes the effective values for the wingbox cross-sections normal to the elements.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="s2">&quot;twist_cp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">]),</span>  <span class="c1"># [deg]</span>
    <span class="s2">&quot;spar_thickness_cp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]),</span>  <span class="c1"># [m]</span>
    <span class="s2">&quot;skin_thickness_cp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.015</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">]),</span>  <span class="c1"># [m]</span>
    <span class="s2">&quot;t_over_c_cp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">]),</span>
    <span class="s2">&quot;original_wingbox_airfoil_t_over_c&quot;</span><span class="p">:</span> <span class="mf">0.12</span><span class="p">,</span>
</pre></div>
</div>
<p>Next, we provide some information related to aerodynamics and specify some options.
We set <cite>CDO</cite> to 0.0078 to account for the drag from the fuselage, tail surfaces, nacelles, and pylons (which are not being modeled).
We set <cite>with_viscous</cite> to <cite>True</cite> to make OpenAeroStruct include an estimate for viscous drag (empirical equations) when computing the drag of the wing.
We set <cite>with_wave</cite> to <cite>True</cite> to make OpenAeroStruct also include an estimate for wave drag using the empirical equations based on the Korn equation.
This wave drag estimate needs a thickness-to-chord ratio value and a sweep angle value for the wing.
This is computed internally by averaging the thickness-to-chord ratios and sweep angles across the span of the wing weighted by the widths of the corresponding VLM panels.
Keep this in mind when creating wing meshes and setting up optimization problems using the wingbox model.
The optimizer may try to take advantage of this averaging.</p>
<p>The <cite>k_lam</cite> value is the fraction of the chord assumed to have laminar flow, and is used for OpenAeroStruct’s viscous drag estimates (empirical equations).
The <cite>c_max_t</cite> value is the location of the maximum thickness of the airfoil along the chord, and is also used for OpenAeroStruct’s viscous drag estimates.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Aerodynamic deltas.</span>
    <span class="c1"># These CL0 and CD0 values are added to the CL and CD</span>
    <span class="c1"># obtained from aerodynamic analysis of the surface to get</span>
    <span class="c1"># the total CL and CD.</span>
    <span class="c1"># These CL0 and CD0 values do not vary wrt alpha.</span>
    <span class="c1"># They can be used to account for things that are not included, such as contributions from the fuselage, camber, etc.</span>
    <span class="s2">&quot;CL0&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># CL delta</span>
    <span class="s2">&quot;CD0&quot;</span><span class="p">:</span> <span class="mf">0.0078</span><span class="p">,</span>  <span class="c1"># CD delta</span>
    <span class="s2">&quot;with_viscous&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># if true, compute viscous drag</span>
    <span class="s2">&quot;with_wave&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># if true, compute wave drag</span>
    <span class="c1"># Airfoil properties for viscous drag calculation</span>
    <span class="s2">&quot;k_lam&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>  <span class="c1"># fraction of chord with laminar</span>
    <span class="c1"># flow, used for viscous drag</span>
    <span class="s2">&quot;c_max_t&quot;</span><span class="p">:</span> <span class="mf">0.38</span><span class="p">,</span>  <span class="c1"># chordwise location of maximum thickness</span>
</pre></div>
</div>
<p>Next we provide some information related to structures.
We provide the Young’s and shear moduli, as well as the allowable yield stress and density of the material being used (the wingbox model currently assumes that the material is isotropic).
Here we use include a safety factor of 1.5 in the allowable yield stress.
The <cite>strength_factor_for_upper_skin</cite> value can be used to adjust the yield strength of the upper skin relative to the lower skin.
For example, if we were using different alloys for the top and bottom skin (e.g., Al7075 vs Al2024) we would provide the allowable yield stress of the lower skin for <cite>yield</cite> and the ratio of the yield strengths of the upper skin to the lower skin for <cite>strength_factor_for_upper_skin</cite>.
The <cite>wing_weight_ratio</cite> number is used to estimate the weight of other components not modeled in the wingbox structure (e.g., overlaps, fasteners, etc.).
With the <cite>exact_failure_constraint</cite> set to <cite>False</cite>, we aggregate the stress constraints for the FEM elements into a single constraint using the  Kreisselmeier–Steinhauser function.
This helps reduce computational cost during optimization by replacing a large number of constraints (one for each stress combination for each element) with a single constraint.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># Structural values are based on aluminum 7075</span>
    <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mf">73.1e9</span><span class="p">,</span>  <span class="c1"># [Pa] Young&#39;s modulus</span>
    <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">73.1e9</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="mf">1.33</span><span class="p">),</span>  <span class="c1"># [Pa] shear modulus (calculated using E and the Poisson&#39;s ratio here)</span>
    <span class="s2">&quot;yield&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">420.0e6</span> <span class="o">/</span> <span class="mf">1.5</span><span class="p">),</span>  <span class="c1"># [Pa] allowable yield stress</span>
    <span class="s2">&quot;mrho&quot;</span><span class="p">:</span> <span class="mf">2.78e3</span><span class="p">,</span>  <span class="c1"># [kg/m^3] material density</span>
    <span class="s2">&quot;strength_factor_for_upper_skin&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># the yield stress is multiplied by this factor for the upper skin</span>
    <span class="s2">&quot;wing_weight_ratio&quot;</span><span class="p">:</span> <span class="mf">1.25</span><span class="p">,</span>
    <span class="s2">&quot;exact_failure_constraint&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># if false, use KS function</span>
</pre></div>
</div>
<p>The next two options <cite>struct_weight_relief</cite> and <cite>distributed_fuel_weight</cite> are used to specify whether the user wants the loads from the weight of the wingbox structure and the weight of the fuel to be distributed on the wing structure to provide load relief.
The <cite>struct_weight_relief</cite> is for the loads from the weight of the structure (including the <cite>wing_weight_ratio</cite> factor).
The <cite>distributed_fuel_weight</cite> is for the loads from the weight of the fuel, which is assumed to be distributed across the entire wing (the fraction of the total fuel that each wingbox segment, corresponding to each finite element, holds is equal to the ratio of its enclosed volume to the total enclosed volume of all the wingbox segments).
We can also use the option <cite>n_point_masses</cite> if we want to add loads from point masses on to the wing structure (e.g., for engines).
Here we set <cite>n_point_masses</cite> to 1 because we have one engine on each side of the aircraft (recall that we are using symmetry).
If we did not want to add point masses, we would omit this option (do not set it to 0).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="s2">&quot;struct_weight_relief&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;distributed_fuel_weight&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;n_point_masses&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># number of point masses in the system; in this case, the engine (omit option if no point masses)</span>
</pre></div>
</div>
<p>Next, we specify the density of the fuel (used to compute fuel volume from fuel mass) and also specify how much fuel we are carrying as reserves.
This reserve fuel weight is added to the weight of the aircraft for performance calculations as well as computing the loads from the fuel on the wing when using the <cite>distributed_fuel_weight</cite> option.
With these two final options, we are done with the surface dictionary and add it to a list called surfaces (here we only have one surface, but in general we might have multiple).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="s2">&quot;fuel_density&quot;</span><span class="p">:</span> <span class="mf">803.0</span><span class="p">,</span>  <span class="c1"># [kg/m^3] fuel density (only needed if the fuel-in-wing volume constraint is used)</span>
    <span class="s2">&quot;Wf_reserve&quot;</span><span class="p">:</span> <span class="mf">15000.0</span><span class="p">,</span>  <span class="c1"># [kg] reserve fuel mass</span>
<span class="p">}</span>

<span class="n">surfaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">surf_dict</span><span class="p">]</span>

</pre></div>
</div>
<p>Next, we instantiate the OpenMDAO <cite>Problem</cite> and specify the independent variables.
We will use some of these variables later as design variables and some simply as inputs.
First we provide some inputs related to the flight conditions (Mach number, airspeed, Reynolds number per unit length, air density, and speed of sound).
Since we want to consider two flight points in this example (a nominal cruise case and a 2.5g maneuver case), we provide two values for each input that is different for the two cases.
For example, our cruise Mach number is 0.85 and our maneuver Mach number is 0.64.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Create the problem and assign the model group</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>

<span class="c1"># Add problem information as an independent variables component</span>
<span class="n">indep_var_comp</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">IndepVarComp</span><span class="p">()</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;Mach_number&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.64</span><span class="p">]))</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.85</span> <span class="o">*</span> <span class="mf">295.07</span><span class="p">,</span> <span class="mf">0.64</span> <span class="o">*</span> <span class="mf">340.294</span><span class="p">]),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m/s&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span>
    <span class="s2">&quot;re&quot;</span><span class="p">,</span>
    <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.348</span> <span class="o">*</span> <span class="mf">295.07</span> <span class="o">*</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.43</span> <span class="o">*</span> <span class="mf">1e-5</span><span class="p">),</span> <span class="mf">1.225</span> <span class="o">*</span> <span class="mf">340.294</span> <span class="o">*</span> <span class="mf">0.64</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.81206</span> <span class="o">*</span> <span class="mf">1e-5</span><span class="p">)]),</span>
    <span class="n">units</span><span class="o">=</span><span class="s2">&quot;1/m&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.348</span><span class="p">,</span> <span class="mf">1.225</span><span class="p">]),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg/m**3&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;speed_of_sound&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">295.07</span><span class="p">,</span> <span class="mf">340.294</span><span class="p">]),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m/s&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>The following are some more independent variables.
We have the thrust-specific fuel consumption, <cite>CT</cite>, cruise range, <cite>R</cite>, and the weight of the aircraft without the fuel required for the cruise point and without the weight of the wing structure and point masses, <cite>W0_without_point_masses</cite>.
Since we are not interested in the fuel burn or range at the maneuver point, we only provide a single value for these inputs that will be used for the cruise fuel burn.
Note that <cite>W0_without_point_masses</cite> includes the reserve fuel weight, which is why it is added here.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;CT&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.53</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;1/s&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">14.307e6</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;W0_without_point_masses&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">128000</span> <span class="o">+</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;Wf_reserve&quot;</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>Next, we specify the load factor for each flight point (1g for cruise and 2.5g for the maneuver case).
We also provide values for the angle of attack.
In this case, instead of providing two values as an array for one variable, we add two separate variables with different names (<cite>alpha</cite> and <cite>alpha_maneuver</cite>).
We create two variables just for convenience because, for this example, we allow the optimizer to trim the aircraft for the maneuver case using the angle of attack for that flight point (by making it a design variable), but keep the angle of attack fixed for the cruise case and make the optimizer trim the aircraft for the cruise flight point using the twist distribution.
We also include the empty center of gravity location here as a reminder that we could use it later for studies in which we include tail surfaces and consider pitching moments (not done in this example).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;load_factor&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">]))</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;alpha_maneuver&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>

<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;empty_cg&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">)),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>Finally, we also add the fuel mass as an independent variable to use it as a design variable.
This may seem like a strange design variable to have, but we do this from an optimization architecture point of view.
Instead of directly transferring the fuel burn value from the cruise point to the maneuver point (used to calculate MTOW for the maneuver point), we instead create a constraint (shown later) and make the optimizer ensure that the value being used for the fuel mass is the same value that is computed in the cruise point.
This also allows the flexibility to later decide that you want to use a different value for the fuel mass for the maneuver case (or any other flight point you may have) that does not depend on the cruise point (or any other flight point you may have).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;prob_vars&quot;</span><span class="p">,</span> <span class="n">indep_var_comp</span><span class="p">,</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">])</span>

</pre></div>
</div>
<p>Next, we include the engine mass magnitude and locations in the problem.
OpenAeroStruct can handle any generic point masses add to the structural system.
In this case, we’re adding the engine mass, which is set to 10,000 kg, to an appropriate location in front of the wing.
The <cite>point_mass_locations</cite> coordinates are in the global frame.
The loads caused by the point masses are transferred to the structural nodes based on the nodes’ proximity to the point masses (using an inverse-distance approach).
We then compute the actual <cite>W0</cite> value by summing the <cite>point_masses</cite> and <cite>W0_without_point_masses</cite>.
We multiply the sum of <cite>point_masses</cite> by 2 because we are using symmetry.
Thus, the <cite>W0</cite> value used in subsequent components includes the point masses, reserve fuel weight, and all weights of the aircraft except the wing structural mass and computed fuel burn.
We add <cite>point_masses</cite> and <cite>point_mass_locations</cite> using <cite>indep_var_comp</cite> so that they can be changed during optimization (although they are not in this example).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">point_masses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">10.0e3</span><span class="p">]])</span>

<span class="n">point_mass_locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]])</span>

<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;point_masses&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">point_masses</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;point_mass_locations&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">point_mass_locations</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>

<span class="c1"># Compute the actual W0 to be used within OAS based on the sum of the point mass and other W0 weight</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span>
    <span class="s2">&quot;W0_comp&quot;</span><span class="p">,</span> <span class="n">om</span><span class="o">.</span><span class="n">ExecComp</span><span class="p">(</span><span class="s2">&quot;W0 = W0_without_point_masses + 2 * sum(point_masses)&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>
<span class="p">)</span>

</pre></div>
</div>
<p>Next, we instantiate aerostructual <cite>groups</cite> for each surface (only one in this example) and add them to the model.
We use a loop for generality but it is not necessary for this example because we only have one surface (just the wing).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Loop over each surface in the surfaces list</span>
<span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="n">surfaces</span><span class="p">:</span>

    <span class="c1"># Get the surface name and create a group to contain components</span>
    <span class="c1"># only for this surface</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

    <span class="n">aerostruct_group</span> <span class="o">=</span> <span class="n">AerostructGeometry</span><span class="p">(</span><span class="n">surface</span><span class="o">=</span><span class="n">surface</span><span class="p">)</span>

    <span class="c1"># Add groups to the problem with the name of the surface.</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">aerostruct_group</span><span class="p">)</span>

</pre></div>
</div>
<p>Now we have to instantiate aerostructural flight points (one for cruise and one for the maneuver case in this example), add them to the model, and after that connect the inputs to the points.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Loop through and add a certain number of aerostruct points</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>

    <span class="n">point_name</span> <span class="o">=</span> <span class="s2">&quot;AS_point_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="c1"># Connect the parameters within the model for each aero point</span>

    <span class="c1"># Create the aerostruct point group and add it to the model</span>
    <span class="n">AS_point</span> <span class="o">=</span> <span class="n">AerostructPoint</span><span class="p">(</span><span class="n">surfaces</span><span class="o">=</span><span class="n">surfaces</span><span class="p">,</span> <span class="n">internally_connect_fuelburn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">point_name</span><span class="p">,</span> <span class="n">AS_point</span><span class="p">)</span>

</pre></div>
</div>
<p>Here we make connect the inputs to the flight points.
For the inputs that have different values for each flight point, we also specify the <cite>src_indices</cite> to specify which one of the input values to use.
In some connections you may notice slightly different naming.
For example, for the air density we write <cite>‘rho’, point_name + ‘.rho’</cite>, but for the fuel mass we write <cite>‘fuel_mass’, point_name + ‘.total_perf.L_equals_W.fuelburn’</cite>.
This has to do with how the variables belonging to different components and groups have been promoted (i.e., which level in the hierarchy they are available at).
If you are unsure about where variables have been promoted to, while making connections on your own later, use OpenMDAO’s feature for visualizing the N2 diagram (commands shown later).
Hovering over variables in this diagram should tell you what names to use for them.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
    <span class="c1"># Connect flow properties to the analysis point</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.v&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;Mach_number&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.Mach_number&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;re&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.re&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.rho&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;CT&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.CT&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.R&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;W0&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.W0&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;speed_of_sound&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.speed_of_sound&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;empty_cg&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.empty_cg&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;load_factor&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.load_factor&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.total_perf.L_equals_W.fuelburn&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.total_perf.CG.fuelburn&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>Now we have to make a few more internal connections that are not made automatically.
Once again, if you are unsure about whether variables have been connected correctly, use OpenMDAO’s N2 diagram visualization feature (commands shown later).
That diagram should show the connections, and the variables that have not been connected will be highlighted in red.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
    <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="n">surfaces</span><span class="p">:</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;distributed_fuel_weight&quot;</span><span class="p">]:</span>
            <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;load_factor&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.load_factor&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">com_name</span> <span class="o">=</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_perf.&quot;</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.local_stiff_transformed&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.local_stiff_transformed&quot;</span>
        <span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.nodes&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.nodes&quot;</span><span class="p">)</span>

        <span class="c1"># Connect aerodyamic mesh to coupled group mesh</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.mesh&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.mesh&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;struct_weight_relief&quot;</span><span class="p">]:</span>
            <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.element_mass&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.element_mass&quot;</span><span class="p">)</span>

        <span class="c1"># Connect performance calculation variables</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.nodes&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;nodes&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.cg_location&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="s2">&quot;total_perf.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_cg_location&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.structural_mass&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="s2">&quot;total_perf.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_structural_mass&quot;</span><span class="p">)</span>

        <span class="c1"># Connect wingbox properties to von Mises stress calcs</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.Qz&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;Qz&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.J&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;J&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.A_enc&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;A_enc&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.htop&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;htop&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.hbottom&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;hbottom&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.hfront&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;hfront&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.hrear&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;hrear&quot;</span><span class="p">)</span>

        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.spar_thickness&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;spar_thickness&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.t_over_c&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;t_over_c&quot;</span><span class="p">)</span>

        <span class="n">coupled_name</span> <span class="o">=</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.&quot;</span> <span class="o">+</span> <span class="n">name</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;point_masses&quot;</span><span class="p">,</span> <span class="n">coupled_name</span> <span class="o">+</span> <span class="s2">&quot;.point_masses&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;point_mass_locations&quot;</span><span class="p">,</span> <span class="n">coupled_name</span> <span class="o">+</span> <span class="s2">&quot;.point_mass_locations&quot;</span><span class="p">)</span>


</pre></div>
</div>
<p>We have a couple more connections to make outside the loop because of the variable naming.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_0&quot;</span> <span class="o">+</span> <span class="s2">&quot;.alpha&quot;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;alpha_maneuver&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_1&quot;</span> <span class="o">+</span> <span class="s2">&quot;.alpha&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>For this example, we are also interested in adding a fuel-volume constraint that makes sure that the wingbox has enough internal volume to store the required fuel mass (estimated from the cruise flight point plus the reserve fuel).
First we instantiate and add the component that computes the difference between the available internal volume and the required fuel volume (<cite>WingboxFuelVolDelta</cite>).
Then we make some connections.
We connect the fuel burn computed from the cruise condition to this component because we are interested in the fuel burn value from the cruise condition.
We also have an <cite>if</cite> statement to make some more connections if we want the loads from the weight of the fuel to be applied to the FEM model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Here we add the fuel volume constraint componenet to the model</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;fuel_vol_delta&quot;</span><span class="p">,</span> <span class="n">WingboxFuelVolDelta</span><span class="p">(</span><span class="n">surface</span><span class="o">=</span><span class="n">surface</span><span class="p">))</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;wing.struct_setup.fuel_vols&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel_vol_delta.fuel_vols&quot;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;AS_point_0.fuelburn&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel_vol_delta.fuelburn&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;distributed_fuel_weight&quot;</span><span class="p">]:</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;wing.struct_setup.fuel_vols&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_0.coupled.wing.struct_states.fuel_vols&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_0.coupled.wing.struct_states.fuel_mass&quot;</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;wing.struct_setup.fuel_vols&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_1.coupled.wing.struct_states.fuel_vols&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_1.coupled.wing.struct_states.fuel_mass&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>Next, we use OpenMDAO’s ExecComp feature (which can be used to quickly create simple components) to create a component that is used later for the constraint that ensures that the fuel mass value (used to compute the aircraft weight and fuel loads) is the same as the fuel burn mass computed from the cruise point (i.e., AS_point_0 here).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">comp</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">ExecComp</span><span class="p">(</span><span class="s2">&quot;fuel_diff = (fuel_mass - fuelburn) / fuelburn&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;fuel_diff&quot;</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">promotes_inputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">],</span> <span class="n">promotes_outputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fuel_diff&quot;</span><span class="p">])</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;AS_point_0.fuelburn&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel_diff.fuelburn&quot;</span><span class="p">)</span>

</pre></div>
</div>
<p>Now it is time to specify the objective function and design variables.
For this example, the objective function is the fuel burn computed using the cruise point (AS_point_0).
The design variables are the control points for the twist, spar thickness, skin thickness, and thickness-to-chord ratio distributions.
We add these design variables along with upper and lower bounds, and scalers.
The scalers are used to scale the values of the design variables to help the optimizer converge better.
Usually a scaler that brings the design variable to an order of magnitude around 1 is recommended.
We also have a design variable for the maneuver angle of attack.
In this example, the cruise angle of attack (which rotates the entire wing) is fixed at 0 and the optimizer uses the twist distribution to trim the aircraft for cruise.
Then using this same twist distribution, the maneuver case is trimmed using the maneuver angle of attack design variable.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s2">&quot;AS_point_0.fuelburn&quot;</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;wing.twist_cp&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;wing.spar_thickness_cp&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.003</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e2</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;wing.skin_thickness_cp&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.003</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e2</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;wing.geometry.t_over_c_cp&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;alpha_maneuver&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

</pre></div>
</div>
<p>Next we add some constraints.
For the cruise point, we specify a nominal coefficient of lift of 0.5.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;AS_point_0.CL&quot;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

</pre></div>
</div>
<p>For the maneuver point, we use the following constraints to ensure that the lift equals the weight, and that the stresses in the structure do not exceed the specified allowable value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;AS_point_1.L_equals_W&quot;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;AS_point_1.wing_perf.failure&quot;</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

</pre></div>
</div>
<p>For this example, we also add a constraint that ensures that the wingbox has enough internal volume for the fuel.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;fuel_vol_delta.fuel_vol_delta&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

</pre></div>
</div>
<p>Now we add <cite>fuel_mass</cite> as a design variable and add the consistency constraint that ensures that the fuel mass value is the same as the fuel burn mass computed from the cruise point.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">2e5</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;fuel_diff&quot;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

</pre></div>
</div>
<p>Next, we specify an optimizer and its tolerance.
Here we use the easily available SLSQP optimizer from SciPy and specify a very low tolerance to keep the computational cost very low for the purposes of this example.
We recommend that the user experiments with tolerances and uses much tighter tolerances for their studies.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">ScipyOptimizeDriver</span><span class="p">()</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;optimizer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SLSQP&quot;</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;tol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-2</span>

</pre></div>
</div>
<p>We also include the following recorder settings so that OpenMDAO stores the optimization history in a database that can be used with the plot_wingbox.py visualization script in the <cite>utils</cite> sub-directory.
It isn’t necessary to specify the long list of variables (<cite>prob.driver.recording_options[‘includes’]</cite>), and instead we could just use <cite>prob.driver.recording_options[‘includes’] = [‘*’]</cite> to include all variables.
However, for finer meshes, the database becomes extremely large and the visualization script does not work due to memory requirements.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">recorder</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">SqliteRecorder</span><span class="p">(</span><span class="s2">&quot;aerostruct.db&quot;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_recorder</span><span class="p">(</span><span class="n">recorder</span><span class="p">)</span>

<span class="c1"># We could also just use prob.driver.recording_options[&#39;includes&#39;]=[&#39;*&#39;] here, but for large meshes the database file becomes extremely large. So we just select the variables we need.</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;includes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rho&quot;</span><span class="p">,</span>
    <span class="s2">&quot;v&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.cg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.cg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing_loads.loads&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing_loads.loads&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing.normals&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing.normals&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing.widths&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing.widths&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.aero_states.wing_sec_forces&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.aero_states.wing_sec_forces&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.wing_perf.CL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.wing_perf.CL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing.S_ref&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing.S_ref&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.geometry.twist&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.mesh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.skin_thickness&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.spar_thickness&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.t_over_c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.structural_mass&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.wing_perf.vonmises&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.wing_perf.vonmises&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing.def_mesh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing.def_mesh&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;record_objectives&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;record_constraints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;record_desvars&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;record_inputs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

</pre></div>
</div>
<p>Finally, we call the usual commands to setup and run the optimization problem.
Notice that we also have some commands commented out.
The <cite>view_model</cite> command can be used to generate a .html script that can be opened with a web browser to visualize the N2 problem structure.
The <cite>check_partials</cite> command can be used to check partial derivatives when modifying or creating components.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># Set up the problem</span>
<span class="n">prob</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="c1"># om.view_model(prob)</span>

<span class="c1"># prob.check_partials(form=&#39;central&#39;, compact_print=True)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">run_driver</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The fuel burn value is&quot;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s2">&quot;AS_point_0.fuelburn&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;[kg]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;The wingbox mass (excluding the wing_weight_ratio) is&quot;</span><span class="p">,</span>
    <span class="n">prob</span><span class="p">[</span><span class="s2">&quot;wing.structural_mass&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;wing_weight_ratio&quot;</span><span class="p">],</span>
    <span class="s2">&quot;[kg]&quot;</span><span class="p">,</span>
<span class="p">)</span>

</pre></div>
</div>
<p>The complete script for the optimization is as follows.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore the #docs checkpoint comments. They are just used to split up the code for the documentation webpage.</span>
<span class="c1"># docs checkpoint 0</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">openaerostruct.geometry.utils</span> <span class="kn">import</span> <span class="n">generate_mesh</span>
<span class="kn">from</span> <span class="nn">openaerostruct.integration.aerostruct_groups</span> <span class="kn">import</span> <span class="n">AerostructGeometry</span><span class="p">,</span> <span class="n">AerostructPoint</span>
<span class="kn">from</span> <span class="nn">openaerostruct.structures.wingbox_fuel_vol_delta</span> <span class="kn">import</span> <span class="n">WingboxFuelVolDelta</span>
<span class="kn">import</span> <span class="nn">openmdao.api</span> <span class="k">as</span> <span class="nn">om</span>

<span class="c1"># docs checkpoint 1</span>

<span class="c1"># Provide coordinates for a portion of an airfoil for the wingbox cross-section as an nparray with dtype=complex (to work with the complex-step approximation for derivatives).</span>
<span class="c1"># These should be for an airfoil with the chord scaled to 1.</span>
<span class="c1"># We use the 10% to 60% portion of the NASA SC2-0612 airfoil for this case</span>
<span class="c1"># We use the coordinates available from airfoiltools.com. Using such a large number of coordinates is not necessary.</span>
<span class="c1"># The first and last x-coordinates of the upper and lower surfaces must be the same</span>

<span class="c1"># fmt: off</span>
<span class="n">upper_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">,</span> <span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.27</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.36</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.46</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.52</span><span class="p">,</span> <span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.59</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex128&quot;</span><span class="p">)</span>
<span class="n">lower_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">,</span> <span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.27</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.36</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.46</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.52</span><span class="p">,</span> <span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.59</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex128&quot;</span><span class="p">)</span>
<span class="n">upper_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.0447</span><span class="p">,</span>  <span class="mf">0.046</span><span class="p">,</span>  <span class="mf">0.0472</span><span class="p">,</span>  <span class="mf">0.0484</span><span class="p">,</span>  <span class="mf">0.0495</span><span class="p">,</span>  <span class="mf">0.0505</span><span class="p">,</span>  <span class="mf">0.0514</span><span class="p">,</span>  <span class="mf">0.0523</span><span class="p">,</span>  <span class="mf">0.0531</span><span class="p">,</span>  <span class="mf">0.0538</span><span class="p">,</span> <span class="mf">0.0545</span><span class="p">,</span>  <span class="mf">0.0551</span><span class="p">,</span>  <span class="mf">0.0557</span><span class="p">,</span> <span class="mf">0.0563</span><span class="p">,</span>  <span class="mf">0.0568</span><span class="p">,</span> <span class="mf">0.0573</span><span class="p">,</span>  <span class="mf">0.0577</span><span class="p">,</span>  <span class="mf">0.0581</span><span class="p">,</span>  <span class="mf">0.0585</span><span class="p">,</span>  <span class="mf">0.0588</span><span class="p">,</span>  <span class="mf">0.0591</span><span class="p">,</span>  <span class="mf">0.0593</span><span class="p">,</span>  <span class="mf">0.0595</span><span class="p">,</span>  <span class="mf">0.0597</span><span class="p">,</span>  <span class="mf">0.0599</span><span class="p">,</span>  <span class="mf">0.06</span><span class="p">,</span>    <span class="mf">0.0601</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0601</span><span class="p">,</span>  <span class="mf">0.06</span><span class="p">,</span>    <span class="mf">0.0599</span><span class="p">,</span>  <span class="mf">0.0598</span><span class="p">,</span>  <span class="mf">0.0596</span><span class="p">,</span>  <span class="mf">0.0594</span><span class="p">,</span>  <span class="mf">0.0592</span><span class="p">,</span>  <span class="mf">0.0589</span><span class="p">,</span>  <span class="mf">0.0586</span><span class="p">,</span>  <span class="mf">0.0583</span><span class="p">,</span>  <span class="mf">0.058</span><span class="p">,</span>   <span class="mf">0.0576</span><span class="p">,</span>  <span class="mf">0.0572</span><span class="p">,</span>  <span class="mf">0.0568</span><span class="p">,</span>  <span class="mf">0.0563</span><span class="p">,</span>  <span class="mf">0.0558</span><span class="p">,</span>  <span class="mf">0.0553</span><span class="p">,</span>  <span class="mf">0.0547</span><span class="p">,</span>  <span class="mf">0.0541</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex128&quot;</span><span class="p">)</span>  <span class="c1"># noqa: E201, E241</span>
<span class="n">lower_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.0447</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.046</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0473</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0485</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0496</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0506</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0515</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0524</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0532</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.054</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0547</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0554</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.056</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0565</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.057</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0575</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0579</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0583</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0586</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0589</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0592</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0594</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0595</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0596</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0597</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0597</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0596</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0594</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0592</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0589</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0586</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0582</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0578</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0573</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0567</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0561</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0554</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0546</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0538</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0529</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0519</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0509</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0497</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0485</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0472</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0458</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0444</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex128&quot;</span><span class="p">)</span>
<span class="c1"># fmt: on</span>

<span class="c1"># docs checkpoint 2</span>

<span class="c1"># Create a dictionary to store options about the surface</span>
<span class="n">mesh_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;num_y&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
    <span class="s2">&quot;num_x&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;wing_type&quot;</span><span class="p">:</span> <span class="s2">&quot;uCRM_based&quot;</span><span class="p">,</span>
    <span class="s2">&quot;symmetry&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;chord_cos_spacing&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;span_cos_spacing&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;num_twist_cp&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">mesh</span><span class="p">,</span> <span class="n">twist_cp</span> <span class="o">=</span> <span class="n">generate_mesh</span><span class="p">(</span><span class="n">mesh_dict</span><span class="p">)</span>

<span class="c1"># docs checkpoint 3</span>

<span class="n">surf_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Wing definition</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;wing&quot;</span><span class="p">,</span>  <span class="c1"># give the surface some name</span>
    <span class="s2">&quot;symmetry&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># if True, model only one half of the lifting surface</span>
    <span class="s2">&quot;S_ref_type&quot;</span><span class="p">:</span> <span class="s2">&quot;projected&quot;</span><span class="p">,</span>  <span class="c1"># how we compute the wing area,</span>
    <span class="c1"># can be &#39;wetted&#39; or &#39;projected&#39;</span>
    <span class="s2">&quot;mesh&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="p">,</span>
    <span class="s2">&quot;fem_model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;wingbox&quot;</span><span class="p">,</span>  <span class="c1"># &#39;wingbox&#39; or &#39;tube&#39;</span>
    <span class="s2">&quot;data_x_upper&quot;</span><span class="p">:</span> <span class="n">upper_x</span><span class="p">,</span>
    <span class="s2">&quot;data_x_lower&quot;</span><span class="p">:</span> <span class="n">lower_x</span><span class="p">,</span>
    <span class="s2">&quot;data_y_upper&quot;</span><span class="p">:</span> <span class="n">upper_y</span><span class="p">,</span>
    <span class="s2">&quot;data_y_lower&quot;</span><span class="p">:</span> <span class="n">lower_y</span><span class="p">,</span>
    <span class="c1"># docs checkpoint 4</span>
    <span class="s2">&quot;twist_cp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">]),</span>  <span class="c1"># [deg]</span>
    <span class="s2">&quot;spar_thickness_cp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.008</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]),</span>  <span class="c1"># [m]</span>
    <span class="s2">&quot;skin_thickness_cp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.015</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">]),</span>  <span class="c1"># [m]</span>
    <span class="s2">&quot;t_over_c_cp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">]),</span>
    <span class="s2">&quot;original_wingbox_airfoil_t_over_c&quot;</span><span class="p">:</span> <span class="mf">0.12</span><span class="p">,</span>
    <span class="c1"># docs checkpoint 5</span>
    <span class="c1"># Aerodynamic deltas.</span>
    <span class="c1"># These CL0 and CD0 values are added to the CL and CD</span>
    <span class="c1"># obtained from aerodynamic analysis of the surface to get</span>
    <span class="c1"># the total CL and CD.</span>
    <span class="c1"># These CL0 and CD0 values do not vary wrt alpha.</span>
    <span class="c1"># They can be used to account for things that are not included, such as contributions from the fuselage, camber, etc.</span>
    <span class="s2">&quot;CL0&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="c1"># CL delta</span>
    <span class="s2">&quot;CD0&quot;</span><span class="p">:</span> <span class="mf">0.0078</span><span class="p">,</span>  <span class="c1"># CD delta</span>
    <span class="s2">&quot;with_viscous&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># if true, compute viscous drag</span>
    <span class="s2">&quot;with_wave&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># if true, compute wave drag</span>
    <span class="c1"># Airfoil properties for viscous drag calculation</span>
    <span class="s2">&quot;k_lam&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>  <span class="c1"># fraction of chord with laminar</span>
    <span class="c1"># flow, used for viscous drag</span>
    <span class="s2">&quot;c_max_t&quot;</span><span class="p">:</span> <span class="mf">0.38</span><span class="p">,</span>  <span class="c1"># chordwise location of maximum thickness</span>
    <span class="c1"># docs checkpoint 6</span>
    <span class="c1"># Structural values are based on aluminum 7075</span>
    <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mf">73.1e9</span><span class="p">,</span>  <span class="c1"># [Pa] Young&#39;s modulus</span>
    <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">73.1e9</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="mf">1.33</span><span class="p">),</span>  <span class="c1"># [Pa] shear modulus (calculated using E and the Poisson&#39;s ratio here)</span>
    <span class="s2">&quot;yield&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">420.0e6</span> <span class="o">/</span> <span class="mf">1.5</span><span class="p">),</span>  <span class="c1"># [Pa] allowable yield stress</span>
    <span class="s2">&quot;mrho&quot;</span><span class="p">:</span> <span class="mf">2.78e3</span><span class="p">,</span>  <span class="c1"># [kg/m^3] material density</span>
    <span class="s2">&quot;strength_factor_for_upper_skin&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># the yield stress is multiplied by this factor for the upper skin</span>
    <span class="s2">&quot;wing_weight_ratio&quot;</span><span class="p">:</span> <span class="mf">1.25</span><span class="p">,</span>
    <span class="s2">&quot;exact_failure_constraint&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># if false, use KS function</span>
    <span class="c1"># docs checkpoint 7</span>
    <span class="s2">&quot;struct_weight_relief&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;distributed_fuel_weight&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;n_point_masses&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># number of point masses in the system; in this case, the engine (omit option if no point masses)</span>
    <span class="c1"># docs checkpoint 8</span>
    <span class="s2">&quot;fuel_density&quot;</span><span class="p">:</span> <span class="mf">803.0</span><span class="p">,</span>  <span class="c1"># [kg/m^3] fuel density (only needed if the fuel-in-wing volume constraint is used)</span>
    <span class="s2">&quot;Wf_reserve&quot;</span><span class="p">:</span> <span class="mf">15000.0</span><span class="p">,</span>  <span class="c1"># [kg] reserve fuel mass</span>
<span class="p">}</span>

<span class="n">surfaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">surf_dict</span><span class="p">]</span>

<span class="c1"># docs checkpoint 9</span>

<span class="c1"># Create the problem and assign the model group</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>

<span class="c1"># Add problem information as an independent variables component</span>
<span class="n">indep_var_comp</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">IndepVarComp</span><span class="p">()</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;Mach_number&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.64</span><span class="p">]))</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.85</span> <span class="o">*</span> <span class="mf">295.07</span><span class="p">,</span> <span class="mf">0.64</span> <span class="o">*</span> <span class="mf">340.294</span><span class="p">]),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m/s&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span>
    <span class="s2">&quot;re&quot;</span><span class="p">,</span>
    <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.348</span> <span class="o">*</span> <span class="mf">295.07</span> <span class="o">*</span> <span class="mf">0.85</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.43</span> <span class="o">*</span> <span class="mf">1e-5</span><span class="p">),</span> <span class="mf">1.225</span> <span class="o">*</span> <span class="mf">340.294</span> <span class="o">*</span> <span class="mf">0.64</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.81206</span> <span class="o">*</span> <span class="mf">1e-5</span><span class="p">)]),</span>
    <span class="n">units</span><span class="o">=</span><span class="s2">&quot;1/m&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.348</span><span class="p">,</span> <span class="mf">1.225</span><span class="p">]),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg/m**3&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;speed_of_sound&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">295.07</span><span class="p">,</span> <span class="mf">340.294</span><span class="p">]),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m/s&quot;</span><span class="p">)</span>

<span class="c1"># docs checkpoint 10</span>

<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;CT&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.53</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;1/s&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">14.307e6</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;W0_without_point_masses&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">128000</span> <span class="o">+</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;Wf_reserve&quot;</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">)</span>

<span class="c1"># docs checkpoint 11</span>

<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;load_factor&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">]))</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;alpha_maneuver&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>

<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;empty_cg&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">)),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>

<span class="c1"># docs checkpoint 12</span>

<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;prob_vars&quot;</span><span class="p">,</span> <span class="n">indep_var_comp</span><span class="p">,</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">])</span>

<span class="c1"># docs checkpoint 12.5</span>

<span class="n">point_masses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">10.0e3</span><span class="p">]])</span>

<span class="n">point_mass_locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]])</span>

<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;point_masses&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">point_masses</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;point_mass_locations&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">point_mass_locations</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>

<span class="c1"># Compute the actual W0 to be used within OAS based on the sum of the point mass and other W0 weight</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span>
    <span class="s2">&quot;W0_comp&quot;</span><span class="p">,</span> <span class="n">om</span><span class="o">.</span><span class="n">ExecComp</span><span class="p">(</span><span class="s2">&quot;W0 = W0_without_point_masses + 2 * sum(point_masses)&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">),</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># docs checkpoint 13</span>

<span class="c1"># Loop over each surface in the surfaces list</span>
<span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="n">surfaces</span><span class="p">:</span>

    <span class="c1"># Get the surface name and create a group to contain components</span>
    <span class="c1"># only for this surface</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

    <span class="n">aerostruct_group</span> <span class="o">=</span> <span class="n">AerostructGeometry</span><span class="p">(</span><span class="n">surface</span><span class="o">=</span><span class="n">surface</span><span class="p">)</span>

    <span class="c1"># Add groups to the problem with the name of the surface.</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">aerostruct_group</span><span class="p">)</span>

<span class="c1"># docs checkpoint 14</span>

<span class="c1"># Loop through and add a certain number of aerostruct points</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>

    <span class="n">point_name</span> <span class="o">=</span> <span class="s2">&quot;AS_point_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="c1"># Connect the parameters within the model for each aero point</span>

    <span class="c1"># Create the aerostruct point group and add it to the model</span>
    <span class="n">AS_point</span> <span class="o">=</span> <span class="n">AerostructPoint</span><span class="p">(</span><span class="n">surfaces</span><span class="o">=</span><span class="n">surfaces</span><span class="p">,</span> <span class="n">internally_connect_fuelburn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">point_name</span><span class="p">,</span> <span class="n">AS_point</span><span class="p">)</span>

    <span class="c1"># docs checkpoint 15</span>

    <span class="c1"># Connect flow properties to the analysis point</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.v&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;Mach_number&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.Mach_number&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;re&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.re&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.rho&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;CT&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.CT&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.R&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;W0&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.W0&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;speed_of_sound&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.speed_of_sound&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;empty_cg&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.empty_cg&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;load_factor&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.load_factor&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.total_perf.L_equals_W.fuelburn&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.total_perf.CG.fuelburn&quot;</span><span class="p">)</span>

    <span class="c1"># docs checkpoint 16</span>

    <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="n">surfaces</span><span class="p">:</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;distributed_fuel_weight&quot;</span><span class="p">]:</span>
            <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;load_factor&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.load_factor&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">com_name</span> <span class="o">=</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_perf.&quot;</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.local_stiff_transformed&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.local_stiff_transformed&quot;</span>
        <span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.nodes&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.nodes&quot;</span><span class="p">)</span>

        <span class="c1"># Connect aerodyamic mesh to coupled group mesh</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.mesh&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.mesh&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;struct_weight_relief&quot;</span><span class="p">]:</span>
            <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.element_mass&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.element_mass&quot;</span><span class="p">)</span>

        <span class="c1"># Connect performance calculation variables</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.nodes&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;nodes&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.cg_location&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="s2">&quot;total_perf.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_cg_location&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.structural_mass&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="s2">&quot;total_perf.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_structural_mass&quot;</span><span class="p">)</span>

        <span class="c1"># Connect wingbox properties to von Mises stress calcs</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.Qz&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;Qz&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.J&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;J&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.A_enc&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;A_enc&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.htop&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;htop&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.hbottom&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;hbottom&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.hfront&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;hfront&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.hrear&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;hrear&quot;</span><span class="p">)</span>

        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.spar_thickness&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;spar_thickness&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.t_over_c&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;t_over_c&quot;</span><span class="p">)</span>

        <span class="n">coupled_name</span> <span class="o">=</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.&quot;</span> <span class="o">+</span> <span class="n">name</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;point_masses&quot;</span><span class="p">,</span> <span class="n">coupled_name</span> <span class="o">+</span> <span class="s2">&quot;.point_masses&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;point_mass_locations&quot;</span><span class="p">,</span> <span class="n">coupled_name</span> <span class="o">+</span> <span class="s2">&quot;.point_mass_locations&quot;</span><span class="p">)</span>


<span class="c1"># docs checkpoint 17</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_0&quot;</span> <span class="o">+</span> <span class="s2">&quot;.alpha&quot;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;alpha_maneuver&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_1&quot;</span> <span class="o">+</span> <span class="s2">&quot;.alpha&quot;</span><span class="p">)</span>

<span class="c1"># docs checkpoint 18</span>

<span class="c1"># Here we add the fuel volume constraint componenet to the model</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;fuel_vol_delta&quot;</span><span class="p">,</span> <span class="n">WingboxFuelVolDelta</span><span class="p">(</span><span class="n">surface</span><span class="o">=</span><span class="n">surface</span><span class="p">))</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;wing.struct_setup.fuel_vols&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel_vol_delta.fuel_vols&quot;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;AS_point_0.fuelburn&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel_vol_delta.fuelburn&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;distributed_fuel_weight&quot;</span><span class="p">]:</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;wing.struct_setup.fuel_vols&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_0.coupled.wing.struct_states.fuel_vols&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_0.coupled.wing.struct_states.fuel_mass&quot;</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;wing.struct_setup.fuel_vols&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_1.coupled.wing.struct_states.fuel_vols&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_1.coupled.wing.struct_states.fuel_mass&quot;</span><span class="p">)</span>

<span class="c1"># docs checkpoint 19</span>

<span class="n">comp</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">ExecComp</span><span class="p">(</span><span class="s2">&quot;fuel_diff = (fuel_mass - fuelburn) / fuelburn&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;fuel_diff&quot;</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">promotes_inputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">],</span> <span class="n">promotes_outputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fuel_diff&quot;</span><span class="p">])</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;AS_point_0.fuelburn&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel_diff.fuelburn&quot;</span><span class="p">)</span>

<span class="c1"># docs checkpoint 20</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s2">&quot;AS_point_0.fuelburn&quot;</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;wing.twist_cp&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;wing.spar_thickness_cp&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.003</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e2</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;wing.skin_thickness_cp&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.003</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e2</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;wing.geometry.t_over_c_cp&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;alpha_maneuver&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="c1"># docs checkpoint 21</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;AS_point_0.CL&quot;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># docs checkpoint 22</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;AS_point_1.L_equals_W&quot;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;AS_point_1.wing_perf.failure&quot;</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># docs checkpoint 23</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;fuel_vol_delta.fuel_vol_delta&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># docs checkpoint 24</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">2e5</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;fuel_diff&quot;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># docs checkpoint 25</span>

<span class="n">prob</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">ScipyOptimizeDriver</span><span class="p">()</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;optimizer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SLSQP&quot;</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;tol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-2</span>

<span class="c1"># docs checkpoint 26</span>

<span class="n">recorder</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">SqliteRecorder</span><span class="p">(</span><span class="s2">&quot;aerostruct.db&quot;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_recorder</span><span class="p">(</span><span class="n">recorder</span><span class="p">)</span>

<span class="c1"># We could also just use prob.driver.recording_options[&#39;includes&#39;]=[&#39;*&#39;] here, but for large meshes the database file becomes extremely large. So we just select the variables we need.</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;includes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rho&quot;</span><span class="p">,</span>
    <span class="s2">&quot;v&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.cg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.cg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing_loads.loads&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing_loads.loads&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing.normals&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing.normals&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing.widths&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing.widths&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.aero_states.wing_sec_forces&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.aero_states.wing_sec_forces&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.wing_perf.CL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.wing_perf.CL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing.S_ref&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing.S_ref&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.geometry.twist&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.mesh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.skin_thickness&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.spar_thickness&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.t_over_c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.structural_mass&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.wing_perf.vonmises&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.wing_perf.vonmises&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing.def_mesh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing.def_mesh&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;record_objectives&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;record_constraints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;record_desvars&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;record_inputs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># docs checkpoint 27</span>

<span class="c1"># Set up the problem</span>
<span class="n">prob</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="c1"># om.view_model(prob)</span>

<span class="c1"># prob.check_partials(form=&#39;central&#39;, compact_print=True)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">run_driver</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The fuel burn value is&quot;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s2">&quot;AS_point_0.fuelburn&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;[kg]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;The wingbox mass (excluding the wing_weight_ratio) is&quot;</span><span class="p">,</span>
    <span class="n">prob</span><span class="p">[</span><span class="s2">&quot;wing.structural_mass&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;wing_weight_ratio&quot;</span><span class="p">],</span>
    <span class="s2">&quot;[kg]&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># docs checkpoint 28</span>
</pre></div>
</div>
<p>The following are the visualization results (keep in mind that this is with a very large optimization tolerance) for this problem using the <cite>plot_wingbox.py</cite> visualization script (located in the <cite>utils</cite> directory).
This visualization script requires the <cite>.db</cite> file as an argument.
For example, to use it for this example problem, from the example script’s (wingbox_mpt_opt_example.py) location in the OpenAeroStruct <cite>docs</cite> directory, we would use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">../</span><span class="n">utils</span><span class="o">/</span><span class="n">plot_wingbox</span><span class="o">.</span><span class="n">py</span> <span class="n">aerostruct</span><span class="o">.</span><span class="n">db</span>
</pre></div>
</div>
<img alt="_images/wingbox_opt.png" src="_images/wingbox_opt.png" />
<p>This plotting script currently only works for two-flight-point problems like the one described in this walkthrough.</p>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_example.html">Quick Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="aero_walkthrough.html">Aerodynamic Optimization Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="struct_example.html">Structural Optimization Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="aerostructural_walkthrough.html">Aerostructural Walkthrough</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Aerostructural with Wingbox Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_mesh_example.html">User-Provided Mesh Example</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="more_examples.html">More Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="specialty_topics.html">Specialty Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="v1_v2_conversion.html">OpenAeroStruct v1 to v2 Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_contribute.html">How to Contribute to OpenAeroStruct</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="_srcdocs/index.html">Source Docs</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="custom_mesh_example.html" title="User-Provided Mesh Example"
             >next</a> |</li>
        <li class="right" >
          <a href="aerostructural_walkthrough.html" title="Aerostructural Walkthrough"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OpenAeroStruct 2.3.2 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Aerostructural with Wingbox Walkthrough</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, John Jasa, Dr. John Hwang, Justin S. Gray.
      Last updated on Jan 30, 2022.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.4.
    </div>
  </body>
</html>